import{_ as n,c as a,o as s,a as t}from"./app.315daad1.js";const h='{"title":"Effect","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u4F7F\u7528","slug":"\u4F7F\u7528"},{"level":2,"title":"\u601D\u8003","slug":"\u601D\u8003"}],"relativePath":"Vue/Effect/index.md","lastUpdated":1640060973095}',e={},p=t(`<h1 id="effect" tabindex="-1">Effect <a class="header-anchor" href="#effect" aria-hidden="true">#</a></h1><p>vue-next</p><h2 id="\u4F7F\u7528" tabindex="-1">\u4F7F\u7528 <a class="header-anchor" href="#\u4F7F\u7528" aria-hidden="true">#</a></h2><p><code>effect</code> \u5728 vue-next \u4E2D\u7684\u521B\u5EFA\u4E86\u7C7B\u4F3C\u6811\u4E00\u822C\u7684\u6574\u4F53\u7ED3\u6784</p><div class="language-javascript"><pre><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">setCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>effect</code>\u7684\u6536\u96C6\u539F\u7406\u662F\u5728\u4E8E\u5C06\u7528\u6237\u4F20\u9012\u7684\u51FD\u6570\u7ED9\u4E88\u6BCF\u4E2A\u54CD\u5E94\u5F0F\uFF0C\u5728\u54CD\u5E94\u5F0F\u89E6\u53D1\u7684\u65F6\u5019\u88AB\u52A8\u7684\u53BB\u89E6\u53D1\u7528\u6237\u4F20\u5165\u51FD\u6570\uFF0C\u800C\u5E76\u4E0D\u662F\u771F\u7684\u662F\u53BB\u667A\u80FD\u8FA8\u8BC6\u6BCF\u4E2A\u54CD\u5E94\u5F0F\u53BB\u6536\u96C6\u3002</p></div><h2 id="\u601D\u8003" tabindex="-1">\u601D\u8003 <a class="header-anchor" href="#\u601D\u8003" aria-hidden="true">#</a></h2><div class="language-javascript"><pre><code>shouldTrack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// \u6267\u884C\u7684\u65F6\u5019\u7ED9\u5168\u5C40\u7684 activeEffect \u8D4B\u503C</span>
<span class="token comment">// \u5229\u7528\u5168\u5C40\u5C5E\u6027\u6765\u83B7\u53D6\u5F53\u524D\u7684 effect</span>
activeEffect <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token keyword">as</span> any<span class="token punctuation">;</span>
<span class="token comment">// \u6267\u884C\u7528\u6237\u4F20\u5165\u7684 fn</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u7528\u6237\u4F20\u5165\u7684 fn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u91CD\u7F6E</span>
shouldTrack <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
activeEffect <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
</code></pre></div><p>\u5728\u6267\u884C<code>fn</code>\u51FD\u6570\u7684\u65F6\u5019\u4F1A\u89E6\u53D1<code>Proxy</code>\u4EE3\u7406\u7684 get \u51FD\u6570\uFF0C\u8FDB\u884C\u4EE5\u6765\u83B7\u53D6\u3002</p><p>\u6211\u4EEC\u8BE5\u601D\u8003\u7684\u662F\u8FD9\u4E2A\u51FD\u6570\u653E\u5728\u4E86\u54EA\u91CC\uFF0C\u624D\u53EF\u4EE5\u88AB\u54CD\u5E94\u5F0F\u968F\u65F6\u62FF\u5230\uFF1F</p><p>\u5728<code>effect.ts</code>\u6587\u4EF6\u4E2D\u6709\u4E00\u4E2A<code>const targetMap = new WeakMap();</code></p><p><code>targetMap</code>\u5C31\u662F<code>vue</code>\u5728\u6574\u4E2A\u9879\u76EE\u4E2D\u7684\u6240\u6709\u7684\u54CD\u5E94\u5F0F\u7684\u96C6\u5408</p><div class="language-javascript"><pre><code><span class="token comment">// targetMap: {</span>
<span class="token comment">//    obj(\u7528\u6237\u7684\u5BF9\u8C61)\uFF1A new Set(\u6240\u5BF9\u5E94\u9700\u8981\u89E6\u53D1\u7684\u51FD\u6570)</span>
<span class="token comment">// }</span>
</code></pre></div><p>\u5728\u89E6\u53D1\u4EE3\u7406<code>Proxy</code>\u7684\u65F6\u5019\u4F1A\u83B7\u53D6\u5BF9\u5E94\u7684\u89E6\u53D1\u51FD\u6570\uFF0C\u8FDB\u884C\u8C03\u7528\uFF0C\u66F4\u6539\u9875\u9762\u6548\u679C</p>`,14),o=[p];function c(l,u,i,r,k,d){return s(),a("div",null,o)}var _=n(e,[["render",c]]);export{h as __pageData,_ as default};
